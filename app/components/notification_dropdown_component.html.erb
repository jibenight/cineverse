<div class="relative" data-controller="dropdown">
  <button data-action="click->dropdown#toggle" class="relative p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition">
    <svg class="w-5 h-5 text-neutral-600 dark:text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
    </svg>
    <% if @unread_count > 0 %>
      <span id="notifications_badge" class="absolute -top-1 -right-1 w-5 h-5 flex items-center justify-center text-xs font-bold text-white bg-red-500 rounded-full">
        <%= @unread_count > 99 ? '99+' : @unread_count %>
      </span>
    <% end %>
  </button>

  <div data-dropdown-target="menu" class="hidden absolute right-0 mt-2 w-80 rounded-lg bg-white dark:bg-neutral-900 shadow-lg border border-neutral-200 dark:border-neutral-700 z-50 max-h-96 overflow-y-auto">
    <div class="flex items-center justify-between p-3 border-b border-neutral-200 dark:border-neutral-700">
      <h3 class="font-semibold text-sm"><%= I18n.t("nav.notifications") %></h3>
      <% if @unread_count > 0 %>
        <%= button_to I18n.t("pages.notifications.mark_all_read"), mark_all_read_notifications_path, method: :post, class: "text-xs text-amber-500 hover:text-amber-600" %>
      <% end %>
    </div>
    <% if @notifications.any? %>
      <% @notifications.each do |notification| %>
        <div class="p-3 border-b border-neutral-100 dark:border-neutral-800 <%= notification.read? ? '' : 'bg-amber-50/50 dark:bg-amber-900/10' %>">
          <p class="text-sm text-neutral-900 dark:text-neutral-100"><%= notification.action %></p>
          <span class="text-xs text-neutral-400"><%= time_ago_in_words(notification.created_at) %></span>
        </div>
      <% end %>
    <% else %>
      <p class="p-4 text-sm text-neutral-400 text-center"><%= I18n.t("pages.notifications.no_notifications") %></p>
    <% end %>
    <a href="<%= notifications_path %>" class="block p-3 text-center text-sm text-amber-500 hover:text-amber-600">Voir tout</a>
  </div>
</div>
