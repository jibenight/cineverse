<% content_for(:title) { t("nav.chat") } %>
<div class="max-w-7xl mx-auto px-6 py-8">
  <h1 class="text-2xl font-bold mb-6"><%= t("nav.chat") %></h1>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Conversations List -->
    <div class="md:col-span-1 space-y-2">
      <% if @conversations.any? %>
        <% @conversations.each do |conversation| %>
          <% other_user = conversation.other_participant(current_user) %>
          <%= link_to conversation_path(conversation), class: "flex items-center gap-3 p-3 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition #{@conversation == conversation ? 'bg-neutral-100 dark:bg-neutral-800' : ''}" do %>
            <%= render UserAvatarComponent.new(user: other_user, size: :sm) %>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium truncate"><%= other_user.username %></p>
              <p class="text-xs text-neutral-400 truncate"><%= conversation.last_message&.body&.truncate(40) %></p>
            </div>
            <% if conversation.unread_count_for(current_user).positive? %>
              <span class="w-5 h-5 rounded-full bg-amber-500 text-white text-xs flex items-center justify-center"><%= conversation.unread_count_for(current_user) %></span>
            <% end %>
          <% end %>
        <% end %>
      <% else %>
        <p class="text-sm text-neutral-400 text-center py-8">Aucune conversation pour le moment.</p>
      <% end %>
    </div>

    <!-- Conversation Content -->
    <div class="md:col-span-2">
      <% if @conversation %>
        <%= render partial: "conversations/show", locals: { conversation: @conversation } %>
      <% else %>
        <div class="flex items-center justify-center h-64 text-neutral-400 text-sm">
          Selectionnez une conversation pour commencer.
        </div>
      <% end %>
    </div>
  </div>
</div>
