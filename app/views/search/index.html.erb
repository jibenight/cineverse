<% content_for(:title) { "Recherche" } %>
<div class="max-w-7xl mx-auto px-6 py-8">
  <h1 class="text-2xl font-bold mb-6"><%= t("nav.search") %></h1>
  <%= form_with url: search_path, method: :get, class: "mb-8" do %>
    <div class="flex gap-2">
      <input type="text" name="q" value="<%= @query %>" placeholder="Rechercher un film..." autofocus
             class="flex-1 px-4 py-3 rounded-xl bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 text-sm focus:ring-2 focus:ring-amber-500">
      <button type="submit" class="px-6 py-3 rounded-xl bg-amber-500 hover:bg-amber-600 text-white text-sm font-medium transition">Rechercher</button>
    </div>
  <% end %>

  <div id="search_results">
    <% if @movies&.any? %>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
        <% @movies.each do |movie| %>
          <%= render MovieCardComponent.new(movie: movie) %>
        <% end %>
      </div>
      <div class="mt-8"><%== pagy_nav(@pagy) if @pagy&.pages.to_i > 1 %></div>
    <% elsif @tmdb_results&.dig(:results)&.any? %>
      <p class="text-sm text-neutral-400 mb-4"><%= @tmdb_results[:total_results] %> résultats trouvés sur TMDb</p>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
        <% @tmdb_results[:results].each do |result| %>
          <%= button_to import_tmdb_movie_path(tmdb_id: result[:tmdb_id]), method: :post, class: "bg-white dark:bg-[#1A1A1A] rounded-lg border border-neutral-200 dark:border-neutral-800 overflow-hidden text-left hover:ring-2 hover:ring-amber-500 transition cursor-pointer w-full" do %>
            <div class="aspect-[2/3] bg-neutral-800">
              <% if result[:poster_path] %>
                <img src="https://image.tmdb.org/t/p/w342<%= result[:poster_path] %>" alt="<%= result[:title] %>" class="w-full h-full object-cover" loading="lazy">
              <% end %>
            </div>
            <div class="p-3">
              <h3 class="text-sm font-medium truncate"><%= result[:title] %></h3>
              <p class="text-xs text-neutral-400"><%= result[:release_date]&.to_date&.year rescue "" %></p>
            </div>
          <% end %>
        <% end %>
      </div>
    <% elsif @query.present? %>
      <p class="text-neutral-400 text-center py-12"><%= t("general.no_results") %></p>
    <% end %>
  </div>
</div>
